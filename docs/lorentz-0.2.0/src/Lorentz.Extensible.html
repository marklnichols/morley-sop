<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- | This module contains implementation of 'Extensible' values.

@Extensible@ values are an alternative representation of sum-types
for Michelson. Instead of representing them as nested options, we
treat them as (Natural, ByteString) pair, where the first element
of the pair represents the constructor index, while the second is
a packed argument.

With such a representation sum types can be easily upgraded: it is
possible to add new elements to the sum type, and the representation
would not change.

However, such representation essentially limits the applicability of
the values. This module does not provide Michelson-level function to
unwrap the value because it would require traversing all the possible
options in the contract code. While this is possible, it is very
inefficient. Up to this moment, we have not come up with a decent
reason to allow such behavior, so Extensible types are write-only
in Michelson code. They can be unwrapped off-chain with @fromExtVal@.

In order to preserve previous values during migrations, users should
ONLY APPEND items to the underlying sum type. Changing, reordering and
deleting items is not allowed and would lead to compatibility breakage.
Currently, this restriction in not enforced. Only no-argument and
one-argument constructors are supported.

GOOD:
  -- `Extensible GoodSumTypeV1` is backwards compatible
  -- with `Extensible GoodSumTypeV2`
  data GoodSumTypeV1 = A Natural | B
  data GoodSumTypeV2 = A Natural | B | C MText

BAD:
  -- `Extensible BadSumTypeV1` is NOT backwards compatible
  -- with `Extensible BadSumTypeV2`
  data BadSumTypeV1 = A | B
  data BadSumTypeV2 = A Natural | B | C MText
-}</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs #-}</span><span>
</span><a name="line-41"></a><span class="hs-pragma">{-# OPTIONS_GHC -Wno-redundant-constraints #-}</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lorentz.Extensible</span><span>
</span><a name="line-44"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-type">Extensible</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#ExtConversionError"><span class="hs-identifier hs-type">ExtConversionError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#ExtVal"><span class="hs-identifier hs-type">ExtVal</span></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#ExtensibleHasDoc"><span class="hs-identifier hs-type">ExtensibleHasDoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#toExtVal"><span class="hs-identifier hs-var">toExtVal</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#fromExtVal"><span class="hs-identifier hs-var">fromExtVal</span></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#wrapExt"><span class="hs-identifier hs-var">wrapExt</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#WrapExtC"><span class="hs-identifier hs-type">WrapExtC</span></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Kind</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Kind</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Proxy</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Vinyl.TypeLevel</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-type">++</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Buildable</span><span class="hs-special">(</span><span class="hs-identifier hs-var">build</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+||</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">|+</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">||+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Generics</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-type">:+:</span><span class="hs-special">)</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.Generics</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">G</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.TypeLits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AppendSymbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.TypeNats</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-type">+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Base.html"><span class="hs-identifier">Lorentz.Base</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Coercions.html"><span class="hs-identifier">Lorentz.Coercions</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Constraints.html"><span class="hs-identifier">Lorentz.Constraints</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.TypeAnns.html"><span class="hs-identifier">Lorentz.TypeAnns</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Instr.html"><span class="hs-identifier">Lorentz.Instr</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Pack.html"><span class="hs-identifier">Lorentz.Pack</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Michelson.Typed</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Label</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Label</span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Markdown</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Type</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.TypeLits</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-keyword">newtype</span><span> </span><a name="Extensible"><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier">Extensible</span></a></a><span> </span><a name="local-6989586621679656023"><a href="#local-6989586621679656023"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Extensible"><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier">Extensible</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Natural</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">anyclass</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsoValue</span><span class="hs-special">,</span><span> </span><a href="Lorentz.TypeAnns.html#HasTypeAnn"><span class="hs-identifier hs-type">HasTypeAnn</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Wrapped</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-type">Extensible</span></a><span> </span><a href="#local-6989586621679656065"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">type</span><span> </span><a name="ExtVal"><a href="Lorentz.Extensible.html#ExtVal"><span class="hs-identifier">ExtVal</span></a></a><span> </span><a name="local-6989586621679656022"><a href="#local-6989586621679656022"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span> </span><a href="#local-6989586621679656022"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656022"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621679656022"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-keyword">type</span><span> </span><a name="GetCtors"><a href="Lorentz.Extensible.html#GetCtors"><span class="hs-identifier">GetCtors</span></a></a><span> </span><a name="local-6989586621679656021"><a href="#local-6989586621679656021"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#GGetCtors"><span class="hs-identifier hs-type">GGetCtors</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621679656021"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">-- | Converts a value from a Haskell representation to its</span><span>
</span><a name="line-87"></a><span class="hs-comment">--   extensible Michelson representation (i.e. (Natural, Bytestring) pair).</span><span>
</span><a name="line-88"></a><span class="hs-identifier">toExtVal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Extensible.html#ExtVal"><span class="hs-identifier hs-type">ExtVal</span></a><span> </span><a href="#local-6989586621679656072"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679656072"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-type">Extensible</span></a><span> </span><a href="#local-6989586621679656072"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-89"></a><a name="toExtVal"><a href="Lorentz.Extensible.html#toExtVal"><span class="hs-identifier">toExtVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier hs-var">gToExtVal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">G.from</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">-- | Converts a value from an extensible Michelson representation to its</span><span>
</span><a name="line-92"></a><span class="hs-comment">--   Haskell sum-type representation. Fails if the Michelson representation</span><span>
</span><a name="line-93"></a><span class="hs-comment">--   points to a nun-existent constructor, or if we failed to unpack</span><span>
</span><a name="line-94"></a><span class="hs-comment">--   the argument.</span><span>
</span><a name="line-95"></a><span class="hs-identifier">fromExtVal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Extensible.html#ExtVal"><span class="hs-identifier hs-type">ExtVal</span></a><span> </span><a href="#local-6989586621679656071"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-type">Extensible</span></a><span> </span><a href="#local-6989586621679656071"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Lorentz.Extensible.html#ExtConversionError"><span class="hs-identifier hs-type">ExtConversionError</span></a><span> </span><a href="#local-6989586621679656071"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-96"></a><a name="fromExtVal"><a href="Lorentz.Extensible.html#fromExtVal"><span class="hs-identifier">fromExtVal</span></a></a><span> </span><a name="local-6989586621679656073"><a href="#local-6989586621679656073"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">G.to</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier hs-var">gFromExtVal</span></a><span> </span><a href="#local-6989586621679656073"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- | Helper typeclass which allows us to sanely handle cases of no-arg</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- constructor and constructor with one argument.</span><span>
</span><a name="line-100"></a><span class="hs-keyword">class</span><span> </span><a name="WrapExt"><a href="Lorentz.Extensible.html#WrapExt"><span class="hs-identifier">WrapExt</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679656019"><a href="#local-6989586621679656019"><span class="hs-identifier">cf</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CtorField</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-comment">-- | Pack argument on top of the stack, if any required.</span><span>
</span><a name="line-102"></a><span>  </span><a name="packForWrap"><a href="Lorentz.Extensible.html#packForWrap"><span class="hs-identifier">packForWrap</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">AppendCtorField</span></a><span> </span><a href="#local-6989586621679656019"><span class="hs-identifier hs-type">cf</span></a><span> </span><a href="#local-6989586621679656020"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679656020"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Constraints.Scopes.html#NicePackedValue"><span class="hs-identifier hs-type">NicePackedValue</span></a><span> </span><a href="#local-6989586621679656064"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-105"></a><span>         </span><a href="Lorentz.Extensible.html#WrapExt"><span class="hs-identifier hs-type">WrapExt</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">OneField</span><span> </span><a href="#local-6989586621679656064"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-106"></a><span>  </span><a name="local-8214565720324430880"><a href="Lorentz.Extensible.html#packForWrap"><span class="hs-identifier">packForWrap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Instr.html#pack"><span class="hs-identifier hs-var">pack</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Extensible.html#WrapExt"><span class="hs-identifier hs-type">WrapExt</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">NoFields</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-109"></a><span>  </span><a name="local-8214565720324430880"><a href="Lorentz.Extensible.html#packForWrap"><span class="hs-identifier">packForWrap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">unit</span><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Instr.html#pack"><span class="hs-identifier hs-var">pack</span></a><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- | Wraps an argument on top of the stack into an Extensible representation</span><span>
</span><a name="line-112"></a><span class="hs-identifier">wrapExt</span><span>
</span><a name="line-113"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679656066"><a href="#local-6989586621679656066"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679656067"><a href="#local-6989586621679656067"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679656068"><a href="#local-6989586621679656068"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679656069"><a href="#local-6989586621679656069"><span class="hs-identifier">field</span></a></a><span> </span><a name="local-6989586621679656070"><a href="#local-6989586621679656070"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-114"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#WrapExtC"><span class="hs-identifier hs-type">WrapExtC</span></a><span> </span><a href="#local-6989586621679656066"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656067"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679656068"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656069"><span class="hs-identifier hs-type">field</span></a><span> </span><a href="#local-6989586621679656070"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Label</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;c&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-type">AppendSymbol</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679656068"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">AppendCtorField</span></a><span> </span><a href="#local-6989586621679656069"><span class="hs-identifier hs-type">field</span></a><span> </span><a href="#local-6989586621679656070"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">Extensible</span><span> </span><a href="#local-6989586621679656066"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679656070"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-116"></a><a name="wrapExt"><a href="Lorentz.Extensible.html#wrapExt"><span class="hs-identifier">wrapExt</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#packForWrap"><span class="hs-identifier hs-var">packForWrap</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656069"><span class="hs-identifier hs-type">field</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Instr.html#push"><span class="hs-identifier hs-var">push</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">natVal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656067"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Instr.html#pair"><span class="hs-identifier hs-var">pair</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Coercions.html#coerceWrap"><span class="hs-identifier hs-var">coerceWrap</span></a><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-keyword">type</span><span> </span><a name="WrapExtC"><a href="Lorentz.Extensible.html#WrapExtC"><span class="hs-identifier">WrapExtC</span></a></a><span> </span><a name="local-6989586621679656014"><a href="#local-6989586621679656014"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679656015"><a href="#local-6989586621679656015"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679656016"><a href="#local-6989586621679656016"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679656017"><a href="#local-6989586621679656017"><span class="hs-identifier">field</span></a></a><span> </span><a name="local-6989586621679656018"><a href="#local-6989586621679656018"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-119"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Ctor</span><span> </span><a href="#local-6989586621679656015"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679656016"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656017"><span class="hs-identifier hs-type">field</span></a><span> </span><span class="hs-glyph">~</span><span> </span><a href="Lorentz.Extensible.html#LookupCtor"><span class="hs-identifier hs-type">LookupCtor</span></a><span> </span><a href="#local-6989586621679656016"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#EnumerateCtors"><span class="hs-identifier hs-type">EnumerateCtors</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#GetCtors"><span class="hs-identifier hs-type">GetCtors</span></a><span> </span><a href="#local-6989586621679656014"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#WrapExt"><span class="hs-identifier hs-type">WrapExt</span></a><span> </span><a href="#local-6989586621679656017"><span class="hs-identifier hs-type">field</span></a><span>
</span><a name="line-121"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">KnownNat</span><span> </span><a href="#local-6989586621679656015"><span class="hs-identifier hs-type">n</span></a><span>
</span><a name="line-122"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- | Errors related to fromExtVal conversion</span><span>
</span><a name="line-125"></a><span class="hs-keyword">data</span><span> </span><a name="ExtConversionError"><a href="Lorentz.Extensible.html#ExtConversionError"><span class="hs-identifier">ExtConversionError</span></a></a><span>
</span><a name="line-126"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ConstructorIndexNotFound"><a href="Lorentz.Extensible.html#ConstructorIndexNotFound"><span class="hs-identifier">ConstructorIndexNotFound</span></a></a><span> </span><span class="hs-identifier hs-type">Natural</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArgumentUnpackFailed"><a href="Lorentz.Extensible.html#ArgumentUnpackFailed"><span class="hs-identifier">ArgumentUnpackFailed</span></a></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="Lorentz.Extensible.html#ExtConversionError"><span class="hs-identifier hs-type">ExtConversionError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-131"></a><span>  </span><a name="local-8214565720323801287"><span class="hs-identifier">build</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-133"></a><span>      </span><a href="Lorentz.Extensible.html#ConstructorIndexNotFound"><span class="hs-identifier hs-var">ConstructorIndexNotFound</span></a><span> </span><a name="local-6989586621679656063"><a href="#local-6989586621679656063"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-string">&quot;Could not convert Extensible value into its Haskell representation: \
        \constructor #&quot;</span><span> </span><span class="hs-operator hs-var">+||</span><span> </span><a href="#local-6989586621679656063"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">||+</span><span> </span><span class="hs-string">&quot; was not found in the sum type \
        \constructors list&quot;</span><span>
</span><a name="line-137"></a><span>      </span><a href="Lorentz.Extensible.html#ArgumentUnpackFailed"><span class="hs-identifier hs-var">ArgumentUnpackFailed</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-138"></a><span>        </span><span class="hs-string">&quot;Could not convert Extensible value into its Haskell representation: \
        \failed to unpack constructor argument&quot;</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-keyword">data</span><span> </span><a name="Position"><a href="Lorentz.Extensible.html#Position"><span class="hs-identifier">Position</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Position"><a href="Lorentz.Extensible.html#Position"><span class="hs-identifier">Position</span></a></a><span> </span><span class="hs-identifier hs-type">Nat</span><span>
</span><a name="line-142"></a><span class="hs-keyword">data</span><span> </span><a name="Ctor"><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier">Ctor</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Ctor"><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier">Ctor</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="_n"><a href="Lorentz.Extensible.html#_n"><span class="hs-identifier">_n</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">,</span><span> </span><a name="_name"><a href="Lorentz.Extensible.html#_name"><span class="hs-identifier">_name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">,</span><span> </span><a name="_param"><a href="Lorentz.Extensible.html#_param"><span class="hs-identifier">_param</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CtorField</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-143"></a><span class="hs-keyword">type</span><span> </span><a name="CtorKind"><a href="Lorentz.Extensible.html#CtorKind"><span class="hs-identifier">CtorKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CtorField</span><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-comment">-- | Finds the constructor's position and argument type by its name</span><span>
</span><a name="line-146"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="LookupCtor"><a href="Lorentz.Extensible.html#LookupCtor"><span class="hs-identifier">LookupCtor</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679656004"><a href="#local-6989586621679656004"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679656005"><a href="#local-6989586621679656005"><span class="hs-identifier">entries</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-148"></a><span>  </span><span class="hs-identifier">LookupCtor</span><span> </span><a href="#local-6989586621679656006"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Ctor</span><span> </span><a href="#local-6989586621679656007"><span class="hs-identifier hs-type">pos</span></a><span> </span><a href="#local-6989586621679656006"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656008"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a><span> </span><a href="#local-6989586621679656007"><span class="hs-identifier hs-type">pos</span></a><span> </span><a href="#local-6989586621679656006"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656008"><span class="hs-identifier hs-type">param</span></a><span>
</span><a name="line-149"></a><span>  </span><span class="hs-identifier">LookupCtor</span><span> </span><a href="#local-6989586621679656010"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">_</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679656011"><span class="hs-identifier hs-type">entries</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-150"></a><span>    </span><a href="Lorentz.Extensible.html#LookupCtor"><span class="hs-identifier hs-type">LookupCtor</span></a><span> </span><a href="#local-6989586621679656010"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656011"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-151"></a><span>  </span><span class="hs-identifier">LookupCtor</span><span> </span><a href="#local-6989586621679656013"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-identifier hs-type">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Constructor &quot;</span><span> </span><span class="hs-special">'</span><span class="hs-operator hs-type">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">ShowType</span><span> </span><a href="#local-6989586621679656013"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span>
</span><a name="line-153"></a><span>               </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot; is not in the sum type constructor list&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- | Transform list of 'CtorKind's to list of 'Ctor's, assigning numbers</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- to elements starting from 0.</span><span>
</span><a name="line-157"></a><span class="hs-keyword">type</span><span> </span><a name="EnumerateCtors"><a href="Lorentz.Extensible.html#EnumerateCtors"><span class="hs-identifier">EnumerateCtors</span></a></a><span> </span><a name="local-6989586621679656003"><a href="#local-6989586621679656003"><span class="hs-identifier">ctors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#EnumerateCtorsImpl"><span class="hs-identifier hs-type">EnumerateCtorsImpl</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><a href="Lorentz.Extensible.html#Position"><span class="hs-identifier hs-type">Position</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679656003"><span class="hs-identifier hs-type">ctors</span></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="EnumerateCtorsImpl"><a href="Lorentz.Extensible.html#EnumerateCtorsImpl"><span class="hs-identifier">EnumerateCtorsImpl</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679655996"><a href="#local-6989586621679655996"><span class="hs-identifier">pos</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Extensible.html#Position"><span class="hs-identifier hs-type">Position</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679655997"><a href="#local-6989586621679655997"><span class="hs-identifier">ctors</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.Extensible.html#CtorKind"><span class="hs-identifier hs-type">CtorKind</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-160"></a><span>  </span><span class="hs-identifier">EnumerateCtorsImpl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-identifier">EnumerateCtorsImpl</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><a href="Lorentz.Extensible.html#Position"><span class="hs-identifier hs-type">Position</span></a><span> </span><a href="#local-6989586621679655999"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621679656000"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679656001"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679656002"><span class="hs-identifier hs-type">cs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Ctor</span><span> </span><a href="#local-6989586621679655999"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679656000"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656001"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="Lorentz.Extensible.html#EnumerateCtorsImpl"><span class="hs-identifier hs-type">EnumerateCtorsImpl</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><a href="Lorentz.Extensible.html#Position"><span class="hs-identifier hs-type">Position</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">i</span><span> </span><span class="hs-operator hs-type">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679656002"><span class="hs-identifier hs-type">cs</span></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Having a sum-type, yields a type-level list of its constructors</span><span>
</span><a name="line-165"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="GGetCtors"><a href="Lorentz.Extensible.html#GGetCtors"><span class="hs-identifier">GGetCtors</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679655983"><a href="#local-6989586621679655983"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.Extensible.html#CtorKind"><span class="hs-identifier hs-type">CtorKind</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-identifier">GGetCtors</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.D1</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679655984"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#GGetCtors"><span class="hs-identifier hs-type">GGetCtors</span></a><span> </span><a href="#local-6989586621679655984"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-167"></a><span>  </span><span class="hs-identifier">GGetCtors</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">G.MetaCons</span><span> </span><a href="#local-6989586621679655986"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679655987"><span class="hs-identifier hs-type">_1</span></a><span> </span><a href="#local-6989586621679655988"><span class="hs-identifier hs-type">_2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.S1</span><span> </span><a href="#local-6989586621679655989"><span class="hs-identifier hs-type">_3</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rec0</span><span> </span><a href="#local-6989586621679655990"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621679655986"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">OneField</span><span> </span><a href="#local-6989586621679655990"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-identifier">GGetCtors</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">G.MetaCons</span><span> </span><a href="#local-6989586621679655991"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679655992"><span class="hs-identifier hs-type">_1</span></a><span> </span><a href="#local-6989586621679655993"><span class="hs-identifier hs-type">_2</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">G.U1</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621679655991"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">NoFields</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-171"></a><span>  </span><span class="hs-identifier">GGetCtors</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-operator hs-type">:+:</span><span> </span><a href="#local-6989586621679655995"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">GGetCtors</span><span> </span><a href="#local-6989586621679655994"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-operator">++</span><span> </span><a href="Lorentz.Extensible.html#GGetCtors"><span class="hs-identifier hs-type">GGetCtors</span></a><span> </span><a href="#local-6989586621679655995"><span class="hs-identifier hs-type">y</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- | Generic implementation of toExtVal and fromExtVal</span><span>
</span><a name="line-174"></a><span class="hs-keyword">class</span><span> </span><a name="GExtVal"><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier">GExtVal</span></a></a><span> </span><a name="local-6989586621679655979"><a href="#local-6989586621679655979"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679655980"><a href="#local-6989586621679655980"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>  </span><a name="gToExtVal"><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier">gToExtVal</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679655980"><span class="hs-identifier hs-type">x</span></a><span> </span><a href="#local-6989586621679655981"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-type">Extensible</span></a><span> </span><a href="#local-6989586621679655979"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-176"></a><span>  </span><a name="gFromExtVal"><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier">gFromExtVal</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-type">Extensible</span></a><span> </span><a href="#local-6989586621679655979"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Lorentz.Extensible.html#ExtConversionError"><span class="hs-identifier hs-type">ExtConversionError</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679655980"><span class="hs-identifier hs-type">x</span></a><span> </span><a href="#local-6989586621679655982"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656059"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656060"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656059"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.D1</span><span> </span><a href="#local-6989586621679656061"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679656060"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-179"></a><span>  </span><a name="local-8214565720324430861"><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier">gToExtVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier hs-var">gToExtVal</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656059"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">G.unM1</span><span>
</span><a name="line-180"></a><span>  </span><a name="local-8214565720324430862"><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier">gFromExtVal</span></a></a><span> </span><a name="local-6989586621679656062"><a href="#local-6989586621679656062"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier hs-var">gFromExtVal</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656059"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656062"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Ctor</span><span> </span><a href="#local-6989586621679656053"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679656054"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">NoFields</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="Lorentz.Extensible.html#LookupCtor"><span class="hs-identifier hs-type">LookupCtor</span></a><span> </span><a href="#local-6989586621679656054"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#EnumerateCtors"><span class="hs-identifier hs-type">EnumerateCtors</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#GetCtors"><span class="hs-identifier hs-type">GetCtors</span></a><span> </span><a href="#local-6989586621679656055"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">KnownNat</span><span> </span><a href="#local-6989586621679656053"><span class="hs-identifier hs-type">n</span></a><span>
</span><a name="line-184"></a><span>         </span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656055"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">G.MetaCons</span><span> </span><a href="#local-6989586621679656054"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656056"><span class="hs-identifier hs-type">_1</span></a><span> </span><a href="#local-6989586621679656057"><span class="hs-identifier hs-type">_2</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">G.U1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-186"></a><span>  </span><a name="local-8214565720324430861"><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier">gToExtVal</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-identifier hs-var">G.U1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span>
</span><a name="line-187"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">natVal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656053"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Pack.html#lPackValue"><span class="hs-identifier hs-var">lPackValue</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>  </span><a name="local-8214565720324430862"><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier">gFromExtVal</span></a></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679656058"><a href="#local-6989586621679656058"><span class="hs-identifier">idx</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679656058"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">natVal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656053"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-identifier hs-var">G.U1</span><span>
</span><a name="line-193"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lorentz.Extensible.html#ConstructorIndexNotFound"><span class="hs-identifier hs-var">ConstructorIndexNotFound</span></a><span> </span><a href="#local-6989586621679656058"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><a href="Lorentz.Constraints.Scopes.html#NiceFullPackedValue"><span class="hs-identifier hs-type">NiceFullPackedValue</span></a><span> </span><a href="#local-6989586621679656043"><span class="hs-identifier hs-type">param</span></a><span>
</span><a name="line-196"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Ctor</span><span> </span><a href="#local-6989586621679656044"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679656045"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">OneField</span><span> </span><a href="#local-6989586621679656043"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="Lorentz.Extensible.html#LookupCtor"><span class="hs-identifier hs-type">LookupCtor</span></a><span> </span><a href="#local-6989586621679656045"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#EnumerateCtors"><span class="hs-identifier hs-type">EnumerateCtors</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#GetCtors"><span class="hs-identifier hs-type">GetCtors</span></a><span> </span><a href="#local-6989586621679656046"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">KnownNat</span><span> </span><a href="#local-6989586621679656044"><span class="hs-identifier hs-type">n</span></a><span>
</span><a name="line-198"></a><span>         </span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656046"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">G.MetaCons</span><span> </span><a href="#local-6989586621679656045"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656047"><span class="hs-identifier hs-type">_1</span></a><span> </span><a href="#local-6989586621679656048"><span class="hs-identifier hs-type">_2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.S1</span><span> </span><a href="#local-6989586621679656049"><span class="hs-identifier hs-type">_3</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rec0</span><span> </span><a href="#local-6989586621679656043"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-200"></a><span>  </span><a name="local-8214565720324430861"><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier">gToExtVal</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.K1</span><span> </span><a name="local-6989586621679656050"><a href="#local-6989586621679656050"><span class="hs-identifier">param</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span>
</span><a name="line-201"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">natVal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656044"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Pack.html#lPackValue"><span class="hs-identifier hs-var">lPackValue</span></a><span> </span><a href="#local-6989586621679656050"><span class="hs-identifier hs-var">param</span></a><span>
</span><a name="line-203"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>  </span><a name="local-8214565720324430862"><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier">gFromExtVal</span></a></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679656051"><a href="#local-6989586621679656051"><span class="hs-identifier">idx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679656052"><a href="#local-6989586621679656052"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679656051"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">natVal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656044"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.Extensible.html#ArgumentUnpackFailed"><span class="hs-identifier hs-var">ArgumentUnpackFailed</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-207"></a><span>          </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">G.K1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lorentz.Pack.html#lUnpackValue"><span class="hs-identifier hs-var">lUnpackValue</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656043"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679656052"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-208"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lorentz.Extensible.html#ConstructorIndexNotFound"><span class="hs-identifier hs-var">ConstructorIndexNotFound</span></a><span> </span><a href="#local-6989586621679656051"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656033"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656034"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656033"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656035"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Extensible.html#GExtVal"><span class="hs-identifier hs-type">GExtVal</span></a><span> </span><a href="#local-6989586621679656033"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-operator hs-type">:+:</span><span> </span><a href="#local-6989586621679656035"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-211"></a><span>  </span><a name="local-8214565720324430861"><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier">gToExtVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-identifier hs-var">G.L1</span><span> </span><a name="local-6989586621679656036"><a href="#local-6989586621679656036"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span> </span><a name="local-6989586621679656037"><a href="#local-6989586621679656037"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier hs-var">gToExtVal</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656033"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656036"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span> </span><a href="#local-6989586621679656037"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-213"></a><span>    </span><span class="hs-identifier hs-var">G.R1</span><span> </span><a name="local-6989586621679656038"><a href="#local-6989586621679656038"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span> </span><a name="local-6989586621679656039"><a href="#local-6989586621679656039"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#gToExtVal"><span class="hs-identifier hs-var">gToExtVal</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656033"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656038"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-var">Extensible</span></a><span> </span><a href="#local-6989586621679656039"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-214"></a><span>  </span><a name="local-8214565720324430862"><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier">gFromExtVal</span></a></a><span> </span><a name="local-6989586621679656040"><a href="#local-6989586621679656040"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679656041"><a href="#local-6989586621679656041"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">G.L1</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier hs-var">gFromExtVal</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656033"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656040"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>        </span><a name="local-6989586621679656042"><a href="#local-6989586621679656042"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">G.R1</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#gFromExtVal"><span class="hs-identifier hs-var">gFromExtVal</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656033"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679656040"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679656041"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679656042"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">-- | Information to be provided for documenting some @'Extensible' x@.</span><span>
</span><a name="line-220"></a><span class="hs-keyword">class</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679655978"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="ExtensibleHasDoc"><a href="Lorentz.Extensible.html#ExtensibleHasDoc"><span class="hs-identifier">ExtensibleHasDoc</span></a></a><span> </span><a name="local-6989586621679655978"><a href="#local-6989586621679655978"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-comment">-- | Implementation for 'typeDocName' of the corresponding @Extensible@.</span><span>
</span><a name="line-222"></a><span>  </span><a name="extensibleDocName"><a href="Lorentz.Extensible.html#extensibleDocName"><span class="hs-identifier">extensibleDocName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679655978"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>  </span><span class="hs-comment">-- | Implementation for 'typeDocDependencies' of the corresponding @Extensible@.</span><span>
</span><a name="line-225"></a><span>  </span><a name="extensibleDocDependencies"><a href="Lorentz.Extensible.html#extensibleDocDependencies"><span class="hs-identifier">extensibleDocDependencies</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679655978"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SomeTypeWithDoc</span><span class="hs-special">]</span><span>
</span><a name="line-226"></a><span>  </span><span class="hs-keyword">default</span><span> </span><a name="extensibleDocDependencies"><a href="Lorentz.Extensible.html#extensibleDocDependencies"><span class="hs-identifier">extensibleDocDependencies</span></a></a><span>
</span><a name="line-227"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span> </span><a href="#local-6989586621679655978"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">GTypeHasDoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621679655978"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679655978"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SomeTypeWithDoc</span><span class="hs-special">]</span><span>
</span><a name="line-229"></a><span>  </span><a name="local-8214565720324430858"><a href="Lorentz.Extensible.html#extensibleDocDependencies"><span class="hs-identifier">extensibleDocDependencies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">genericTypeDocDependencies</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span>  </span><span class="hs-comment">-- | Overall description of this type.</span><span>
</span><a name="line-232"></a><span>  </span><a name="extensibleDocMdDescription"><a href="Lorentz.Extensible.html#extensibleDocMdDescription"><span class="hs-identifier">extensibleDocMdDescription</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- | Helper which documents single constructor.</span><span>
</span><a name="line-235"></a><span class="hs-keyword">class</span><span> </span><a name="DocumentCtor"><a href="Lorentz.Extensible.html#DocumentCtor"><span class="hs-identifier">DocumentCtor</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679655977"><a href="#local-6989586621679655977"><span class="hs-identifier">ctor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-236"></a><span>  </span><a name="documentCtor"><a href="Lorentz.Extensible.html#documentCtor"><span class="hs-identifier">documentCtor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679655977"><span class="hs-identifier hs-type">ctor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-237"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">KnownNat</span><span> </span><a href="#local-6989586621679656029"><span class="hs-identifier hs-type">pos</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621679656030"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeHasDoc</span><span> </span><a href="#local-6989586621679656031"><span class="hs-identifier hs-type">param</span></a><span>
</span><a name="line-238"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">param</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">ExtractCtorField</span><span> </span><a href="#local-6989586621679656032"><span class="hs-identifier hs-type">field</span></a><span>
</span><a name="line-239"></a><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-240"></a><span>         </span><a href="Lorentz.Extensible.html#DocumentCtor"><span class="hs-identifier hs-type">DocumentCtor</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a><span> </span><a href="#local-6989586621679656029"><span class="hs-identifier hs-type">pos</span></a><span> </span><a href="#local-6989586621679656030"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679656032"><span class="hs-identifier hs-type">field</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-241"></a><span>  </span><a name="local-8214565720324430855"><a href="Lorentz.Extensible.html#documentCtor"><span class="hs-identifier">documentCtor</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-242"></a><span>    </span><span class="hs-identifier hs-var">natVal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656029"><span class="hs-identifier hs-type">pos</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">|+</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">mdBold</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">build</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">symbolValT'</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656030"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span>
</span><a name="line-243"></a><span>    </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">typeDocMdReference</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656031"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WithinParens</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><a href="Lorentz.Extensible.html#ExtensibleHasDoc"><span class="hs-identifier hs-type">ExtensibleHasDoc</span></a><span> </span><a href="#local-6989586621679656024"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-246"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ReifyList</span><span> </span><a href="Lorentz.Extensible.html#DocumentCtor"><span class="hs-identifier hs-type">DocumentCtor</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#EnumerateCtors"><span class="hs-identifier hs-type">EnumerateCtors</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#GetCtors"><span class="hs-identifier hs-type">GetCtors</span></a><span> </span><a href="#local-6989586621679656024"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TypeHasDoc</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#Extensible"><span class="hs-identifier hs-type">Extensible</span></a><span> </span><a href="#local-6989586621679656024"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-248"></a><span>  </span><a name="local-8214565720323813647"><span class="hs-identifier">typeDocName</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#extensibleDocName"><span class="hs-identifier hs-var">extensibleDocName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656024"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>  </span><a name="local-8214565720323813645"><span class="hs-identifier">typeDocMdReference</span></a><span> </span><a name="local-6989586621679656025"><a href="#local-6989586621679656025"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WithinParens</span><span> </span><a name="local-6989586621679656026"><a href="#local-6989586621679656026"><span class="hs-identifier">wp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-250"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679656027"><a href="#local-6989586621679656027"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeDocName</span><span> </span><a href="#local-6989586621679656025"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-251"></a><span>        </span><a name="local-6989586621679656028"><a href="#local-6989586621679656028"><span class="hs-identifier">safeName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">T.find</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621679656027"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-252"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679656027"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-253"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-254"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679656026"><span class="hs-identifier hs-var">wp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;(&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679656027"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-255"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679656027"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-256"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">customTypeDocMdReference</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679656028"><span class="hs-identifier hs-var">safeName</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">DType</span><span> </span><a href="#local-6989586621679656025"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WithinParens</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>  </span><a name="local-8214565720323813644"><span class="hs-identifier">typeDocDependencies</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Extensible.html#extensibleDocDependencies"><span class="hs-identifier hs-var">extensibleDocDependencies</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656024"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>  </span><a name="local-8214565720323813643"><span class="hs-identifier">typeDocHaskellRep</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">homomorphicTypeDocHaskellRep</span><span>
</span><a name="line-259"></a><span>  </span><a name="local-8214565720323813642"><span class="hs-identifier">typeDocMichelsonRep</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">homomorphicTypeDocMichelsonRep</span><span>
</span><a name="line-260"></a><span>  </span><a name="local-8214565720323813646"><span class="hs-identifier">typeDocMdDescription</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span>
</span><a name="line-261"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="Lorentz.Extensible.html#extensibleDocMdDescription"><span class="hs-identifier hs-var">extensibleDocMdDescription</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679656024"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-262"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;\n\n&quot;</span><span>
</span><a name="line-263"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;For extensibility purposes this type is represented as `(idx, pack param)`, \
      \where `idx` is a natural number which designates constructor used to \
      \make up given value, and `param` is the argument carried in that \
      \constructor.\n\n&quot;</span><span>
</span><a name="line-267"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;To unwrap value from its `Extensible` representation in Haskell, one should use \
      \`fromExtVal` function provided by `Lorentz.Extensible` module. \
      \This function tries to unwrap an event and may fail if the representation is \
      \invalid (i.e. if it fails to find the corresponding constructor or if the \
      \parameter can not be unpacked.\n\n&quot;</span><span>
</span><a name="line-272"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Value must be one of:\n\n&quot;</span><span>
</span><a name="line-273"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-274"></a><span>        </span><span class="hs-identifier hs-var">Prelude.map</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\n\n&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-275"></a><span>        </span><span class="hs-identifier hs-var">reifyList</span><span> </span><span class="hs-glyph">@</span><a href="Lorentz.Extensible.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a><span> </span><span class="hs-glyph">@</span><a href="Lorentz.Extensible.html#DocumentCtor"><span class="hs-identifier hs-type">DocumentCtor</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#EnumerateCtors"><span class="hs-identifier hs-type">EnumerateCtors</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Extensible.html#GetCtors"><span class="hs-identifier hs-type">GetCtors</span></a><span> </span><a href="#local-6989586621679656024"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Lorentz.Extensible.html#documentCtor"><span class="hs-identifier hs-var">documentCtor</span></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-277"></a></pre></body></html>