<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Identity transformations between different Haskell types.</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lorentz.Coercions</span><span>
</span><a name="line-3"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Safe coercions</span><span>
</span><a name="line-4"></a><span>    </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#castDummyG"><span class="hs-identifier hs-var">castDummyG</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#checkedCoerce"><span class="hs-identifier hs-var">checkedCoerce</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#Coercible_"><span class="hs-identifier hs-type">Coercible_</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#checkedCoerce_"><span class="hs-identifier hs-var">checkedCoerce_</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#checkedCoercing_"><span class="hs-identifier hs-var">checkedCoercing_</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#allowCheckedCoerceTo"><span class="hs-identifier hs-var">allowCheckedCoerceTo</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#allowCheckedCoerce"><span class="hs-identifier hs-var">allowCheckedCoerce</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#coerceUnwrap"><span class="hs-identifier hs-var">coerceUnwrap</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#coerceWrap"><span class="hs-identifier hs-var">coerceWrap</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-comment">-- * Unsafe coercions</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier hs-type">MichelsonCoercible</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#forcedCoerce"><span class="hs-identifier hs-var">forcedCoerce</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#forcedCoerce_"><span class="hs-identifier hs-var">forcedCoerce_</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#gForcedCoerce_"><span class="hs-identifier hs-var">gForcedCoerce_</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#fakeCoerce"><span class="hs-identifier hs-var">fakeCoerce</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#fakeCoercing"><span class="hs-identifier hs-var">fakeCoercing</span></a><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-comment">-- * Re-exports</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Wrapped</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Lens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Wrapped</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Coerce</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Coerce</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Constraint</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dict</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">\\</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.Generics</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">G</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Named</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NamedF</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unsafe.Coerce</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeCoerce</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Address.html"><span class="hs-identifier">Lorentz.Address</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Base.html"><span class="hs-identifier">Lorentz.Base</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Instr.html"><span class="hs-identifier">Lorentz.Instr</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Value.html"><span class="hs-identifier">Lorentz.Value</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Zip.html"><span class="hs-identifier">Lorentz.Zip</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Michelson.Typed</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Label</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Label</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-45"></a><span class="hs-comment">-- Unsafe coercions</span><span>
</span><a name="line-46"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | Coercion for Haskell world.</span><span>
</span><a name="line-49"></a><span class="hs-comment">--</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- We discourage using this function on Lorentz types, consider using 'coerce'</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- instead.</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- One of the reasons forthat is that in Lorentz it's common to declare types as</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- newtypes consisting of existing primitives, and @forcedCoerce@ tends to ignore</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- all phantom type variables of newtypes thus violating their invariants.</span><span>
</span><a name="line-55"></a><span class="hs-identifier">forcedCoerce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Coerce.Coercible</span><span> </span><a href="#local-6989586621679492408"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492409"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679492408"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679492409"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-56"></a><a name="forcedCoerce"><a href="Lorentz.Coercions.html#forcedCoerce"><span class="hs-identifier">forcedCoerce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Coerce.coerce</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-comment">-- | Whether two types have the same Michelson representation.</span><span>
</span><a name="line-59"></a><span class="hs-keyword">type</span><span> </span><a name="MichelsonCoercible"><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier">MichelsonCoercible</span></a></a><span> </span><a name="local-6989586621679492293"><a href="#local-6989586621679492293"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679492294"><a href="#local-6989586621679492294"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679492293"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679492294"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | Convert between values of types that have the same representation.</span><span>
</span><a name="line-62"></a><span class="hs-comment">--</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- This function is not safe in a sense that this allows breaking invariants of</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- casted type (example: @UStore@) or may stop compile on code changes (example:</span><span>
</span><a name="line-65"></a><span class="hs-comment">-- coercion of pair to a datatype with two fields will break if new field is</span><span>
</span><a name="line-66"></a><span class="hs-comment">-- added).</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- Still, produced Michelson code will always be valid.</span><span>
</span><a name="line-68"></a><span class="hs-comment">--</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- Prefer using one of more specific functions from this module.</span><span>
</span><a name="line-70"></a><span class="hs-identifier">forcedCoerce_</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier hs-type">MichelsonCoercible</span></a><span> </span><a href="#local-6989586621679492405"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492406"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-operator hs-type">&amp;</span></a><span> </span><a href="#local-6989586621679492407"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><a href="Lorentz.Base.html#%26"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="Lorentz.Base.html#%26"><span class="hs-operator hs-type">&amp;</span></a><span> </span><a href="#local-6989586621679492407"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-71"></a><a name="forcedCoerce_"><a href="Lorentz.Coercions.html#forcedCoerce_"><span class="hs-identifier">forcedCoerce_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Base.html#I"><span class="hs-identifier hs-var">I</span></a><span> </span><span class="hs-identifier hs-var">Nop</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-identifier">gForcedCoerce_</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier hs-type">MichelsonCoercible</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492401"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679492402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492401"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679492403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679492402"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492404"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">t</span><span> </span><a href="#local-6989586621679492403"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492404"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-74"></a><a name="gForcedCoerce_"><a href="Lorentz.Coercions.html#gForcedCoerce_"><span class="hs-identifier">gForcedCoerce_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#forcedCoerce_"><span class="hs-identifier hs-var">forcedCoerce_</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">-- | Convert between two stacks via failing.</span><span>
</span><a name="line-77"></a><span class="hs-identifier">fakeCoerce</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">s1</span></a><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-operator hs-type">:-&gt;</span></a><span> </span><a href="#local-6989586621679492400"><span class="hs-identifier hs-type">s2</span></a><span>
</span><a name="line-78"></a><a name="fakeCoerce"><a href="Lorentz.Coercions.html#fakeCoerce"><span class="hs-identifier">fakeCoerce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">unit</span><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Base.html#I"><span class="hs-identifier hs-var">I</span></a><span> </span><span class="hs-identifier hs-var">FAILWITH</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-identifier">fakeCoercing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">s1</span></a><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-operator hs-type">:-&gt;</span></a><span> </span><a href="#local-6989586621679492396"><span class="hs-identifier hs-type">s2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">s1'</span></a><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-operator hs-type">:-&gt;</span></a><span> </span><a href="#local-6989586621679492398"><span class="hs-identifier hs-type">s2'</span></a><span>
</span><a name="line-81"></a><a name="fakeCoercing"><a href="Lorentz.Coercions.html#fakeCoercing"><span class="hs-identifier">fakeCoercing</span></a></a><span> </span><a name="local-6989586621679492410"><a href="#local-6989586621679492410"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#fakeCoerce"><span class="hs-identifier hs-var">fakeCoerce</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Base.html#iForceNotFail"><span class="hs-identifier hs-var">iForceNotFail</span></a><span> </span><a href="#local-6989586621679492410"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Coercions.html#fakeCoerce"><span class="hs-identifier hs-var">fakeCoerce</span></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- Safe coercions</span><span>
</span><a name="line-85"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- | Specialized version of 'coerce_' to wrap into a haskell newtype.</span><span>
</span><a name="line-88"></a><span class="hs-identifier">coerceWrap</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679492392"><a href="#local-6989586621679492392"><span class="hs-identifier">newtyp</span></a></a><span> </span><a name="local-6989586621679492393"><a href="#local-6989586621679492393"><span class="hs-identifier">inner</span></a></a><span> </span><a name="local-6989586621679492394"><a href="#local-6989586621679492394"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-90"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">inner</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Unwrapped</span><span> </span><a href="#local-6989586621679492392"><span class="hs-identifier hs-type">newtyp</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier hs-type">MichelsonCoercible</span></a><span> </span><a href="#local-6989586621679492392"><span class="hs-identifier hs-type">newtyp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Unwrapped</span><span> </span><a href="#local-6989586621679492392"><span class="hs-identifier hs-type">newtyp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">inner</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492394"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">newtyp</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492394"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-92"></a><a name="coerceWrap"><a href="Lorentz.Coercions.html#coerceWrap"><span class="hs-identifier">coerceWrap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#forcedCoerce_"><span class="hs-identifier hs-var">forcedCoerce_</span></a><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-comment">-- | Specialized version of 'coerce_' to unwrap a haskell newtype.</span><span>
</span><a name="line-95"></a><span class="hs-identifier">coerceUnwrap</span><span>
</span><a name="line-96"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679492389"><a href="#local-6989586621679492389"><span class="hs-identifier">newtyp</span></a></a><span> </span><a name="local-6989586621679492390"><a href="#local-6989586621679492390"><span class="hs-identifier">inner</span></a></a><span> </span><a name="local-6989586621679492391"><a href="#local-6989586621679492391"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-97"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">inner</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Unwrapped</span><span> </span><a href="#local-6989586621679492389"><span class="hs-identifier hs-type">newtyp</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier hs-type">MichelsonCoercible</span></a><span> </span><a href="#local-6989586621679492389"><span class="hs-identifier hs-type">newtyp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Unwrapped</span><span> </span><a href="#local-6989586621679492389"><span class="hs-identifier hs-type">newtyp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">newtyp</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492391"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">inner</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492391"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-99"></a><a name="coerceUnwrap"><a href="Lorentz.Coercions.html#coerceUnwrap"><span class="hs-identifier">coerceUnwrap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#forcedCoerce_"><span class="hs-identifier hs-var">forcedCoerce_</span></a><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">-- | Lift given value to a named value.</span><span>
</span><a name="line-102"></a><span class="hs-identifier">toNamed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Label</span><span> </span><a href="#local-6989586621679492386"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492388"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">NamedF</span><span> </span><span class="hs-identifier hs-type">Identity</span><span> </span><a href="#local-6989586621679492387"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492386"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492388"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-103"></a><a name="toNamed"><a href="Lorentz.Coercions.html#toNamed"><span class="hs-identifier">toNamed</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#coerceWrap"><span class="hs-identifier hs-var">coerceWrap</span></a><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">-- | Unpack named value.</span><span>
</span><a name="line-106"></a><span class="hs-identifier">fromNamed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Label</span><span> </span><a href="#local-6989586621679492383"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">NamedF</span></a><span> </span><span class="hs-identifier hs-type">Identity</span><span> </span><a href="#local-6989586621679492384"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492383"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492385"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">a</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492385"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-107"></a><a name="fromNamed"><a href="Lorentz.Coercions.html#fromNamed"><span class="hs-identifier">fromNamed</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#coerceUnwrap"><span class="hs-identifier hs-var">coerceUnwrap</span></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-- Arbitrary coercions</span><span>
</span><a name="line-110"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- | Explicitly allowed coercions.</span><span>
</span><a name="line-113"></a><span class="hs-comment">--</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- @a `CanCastTo` b@ proclaims that @a@ can be casted to @b@ without violating</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- any invariants of @b@.</span><span>
</span><a name="line-116"></a><span class="hs-comment">--</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- This relation is reflexive; it /may/ be symmetric or not.</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- It tends to be composable: casting complex types usually requires permission</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- to cast their respective parts; for such types consider using 'castDummyG'</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- as implementation of the method of this typeclass.</span><span>
</span><a name="line-121"></a><span class="hs-comment">--</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- For cases when a cast from @a@ to @b@ requires some validation, consider</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- rather making a dedicated function which performs the necessary checks and</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- then calls @forcedCoerce@.</span><span>
</span><a name="line-125"></a><span class="hs-keyword">class</span><span> </span><a name="local-6989586621679492291"><a href="#local-6989586621679492291"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-special">`</span><a name="CanCastTo"><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier">CanCastTo</span></a></a><span class="hs-special">`</span><span> </span><a name="local-6989586621679492292"><a href="#local-6989586621679492292"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-126"></a><span>  </span><span class="hs-comment">-- | An optional method which helps passing -Wredundant-constraints check.</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-comment">-- Also, you can set specific implementation for it with specific sanity checks.</span><span>
</span><a name="line-128"></a><span>  </span><a name="castDummy"><a href="Lorentz.Coercions.html#castDummy"><span class="hs-identifier">castDummy</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679492291"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679492292"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>  </span><a name="local-8214565720324267163"><a href="Lorentz.Coercions.html#castDummy"><span class="hs-identifier">castDummy</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">-- | Coercion in Haskell world which respects 'CanCastTo'.</span><span>
</span><a name="line-132"></a><span class="hs-identifier">checkedCoerce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679492381"><a href="#local-6989586621679492381"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679492382"><a href="#local-6989586621679492382"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492381"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492382"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Coerce.Coercible</span><span> </span><a href="#local-6989586621679492381"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492382"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679492381"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679492382"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-133"></a><a name="checkedCoerce"><a href="Lorentz.Coercions.html#checkedCoerce"><span class="hs-identifier">checkedCoerce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Coerce.coerce</span><span>
</span><a name="line-134"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679492411"><a href="#local-6989586621679492411"><span class="hs-identifier">_useCast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#castDummy"><span class="hs-identifier hs-var">castDummy</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492381"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492382"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Coercion from @a@ to @b@ is permitted and safe.</span><span>
</span><a name="line-137"></a><span class="hs-keyword">type</span><span> </span><a name="Castable_"><a href="Lorentz.Coercions.html#Castable_"><span class="hs-identifier">Castable_</span></a></a><span> </span><a name="local-6989586621679492289"><a href="#local-6989586621679492289"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679492290"><a href="#local-6989586621679492290"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier hs-type">MichelsonCoercible</span></a><span> </span><a href="#local-6989586621679492289"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492290"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492289"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492290"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-comment">-- | Coercions between @a@ to @b@ are permitted and safe.</span><span>
</span><a name="line-140"></a><span class="hs-keyword">type</span><span> </span><a name="Coercible_"><a href="Lorentz.Coercions.html#Coercible_"><span class="hs-identifier">Coercible_</span></a></a><span> </span><a name="local-6989586621679492287"><a href="#local-6989586621679492287"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679492288"><a href="#local-6989586621679492288"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#MichelsonCoercible"><span class="hs-identifier hs-type">MichelsonCoercible</span></a><span> </span><a href="#local-6989586621679492287"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492288"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492287"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492288"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492288"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679492287"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- | Coerce between types which have an explicit permission for that in the</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- face of 'CanCastTo' constraint.</span><span>
</span><a name="line-144"></a><span class="hs-identifier">checkedCoerce_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679492378"><a href="#local-6989586621679492378"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679492379"><a href="#local-6989586621679492379"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679492380"><a href="#local-6989586621679492380"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#Castable_"><span class="hs-identifier hs-type">Castable_</span></a><span> </span><a href="#local-6989586621679492378"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492379"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492380"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">b</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492380"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-145"></a><a name="checkedCoerce_"><a href="Lorentz.Coercions.html#checkedCoerce_"><span class="hs-identifier">checkedCoerce_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#forcedCoerce_"><span class="hs-identifier hs-var">forcedCoerce_</span></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">-- | Pretends that the top item of the stack was coerced.</span><span>
</span><a name="line-148"></a><span class="hs-identifier">checkedCoercing_</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679492375"><a href="#local-6989586621679492375"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679492376"><a href="#local-6989586621679492376"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679492377"><a href="#local-6989586621679492377"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#Coercible_"><span class="hs-identifier hs-type">Coercible_</span></a><span> </span><a href="#local-6989586621679492375"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492376"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492377"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">b</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492377"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492377"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">a</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679492377"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-151"></a><a name="checkedCoercing_"><a href="Lorentz.Coercions.html#checkedCoercing_"><span class="hs-identifier">checkedCoercing_</span></a></a><span> </span><a name="local-6989586621679492412"><a href="#local-6989586621679492412"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#checkedCoerce_"><span class="hs-identifier hs-var">checkedCoerce_</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492375"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492376"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="#local-6989586621679492412"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Coercions.html#checkedCoerce_"><span class="hs-identifier hs-var">checkedCoerce_</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492376"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492375"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-comment">-- | Locally provide given 'CanCastTo' instance.</span><span>
</span><a name="line-154"></a><span class="hs-identifier">allowCheckedCoerceTo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679492373"><a href="#local-6989586621679492373"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679492374"><a href="#local-6989586621679492374"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Dict</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492374"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492373"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><a name="allowCheckedCoerceTo"><a href="Lorentz.Coercions.html#allowCheckedCoerceTo"><span class="hs-identifier">allowCheckedCoerceTo</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-identifier hs-var">unsafeCoerce</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dict</span><span> </span><span class="hs-operator hs-type">$</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dict</span><span> </span><span class="hs-operator hs-type">$</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492374"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492373"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-identifier hs-var">Dict</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- | Locally provide bidirectional 'CanCastTo' instance.</span><span>
</span><a name="line-162"></a><span class="hs-identifier">allowCheckedCoerce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679492371"><a href="#local-6989586621679492371"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679492372"><a href="#local-6989586621679492372"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Dict</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492371"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492372"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492372"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679492371"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><a name="allowCheckedCoerce"><a href="Lorentz.Coercions.html#allowCheckedCoerce"><span class="hs-identifier">allowCheckedCoerce</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-identifier hs-var">Dict</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="Lorentz.Coercions.html#allowCheckedCoerceTo"><span class="hs-identifier hs-var">allowCheckedCoerceTo</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492371"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492372"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="Lorentz.Coercions.html#allowCheckedCoerceTo"><span class="hs-identifier hs-var">allowCheckedCoerceTo</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492372"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679492371"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">-- Incoherent instances are generally evil because arbitrary instance can be</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- picked, but in our case this is exactly what we want: permit cast if</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- /any/ instance matches.</span><span>
</span><a name="line-169"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# INCOHERENT</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492368"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492368"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492366"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492367"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-172"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679492366"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679492367"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-173"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492364"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492365"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-174"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679492364"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679492365"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492360"><span class="hs-identifier hs-type">l1</span></a><span> </span><a href="#local-6989586621679492361"><span class="hs-identifier hs-type">l2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492362"><span class="hs-identifier hs-type">r1</span></a><span> </span><a href="#local-6989586621679492363"><span class="hs-identifier hs-type">r2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-176"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679492360"><span class="hs-identifier hs-type">l1</span></a><span> </span><a href="#local-6989586621679492362"><span class="hs-identifier hs-type">r1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679492361"><span class="hs-identifier hs-type">l2</span></a><span> </span><a href="#local-6989586621679492363"><span class="hs-identifier hs-type">r2</span></a><span class="hs-special">)</span><span>
</span><a name="line-177"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492358"><span class="hs-identifier hs-type">k1</span></a><span> </span><a href="#local-6989586621679492359"><span class="hs-identifier hs-type">k2</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-178"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span> </span><a href="#local-6989586621679492358"><span class="hs-identifier hs-type">k1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span> </span><a href="#local-6989586621679492359"><span class="hs-identifier hs-type">k2</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492354"><span class="hs-identifier hs-type">k1</span></a><span> </span><a href="#local-6989586621679492355"><span class="hs-identifier hs-type">k2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492356"><span class="hs-identifier hs-type">v1</span></a><span> </span><a href="#local-6989586621679492357"><span class="hs-identifier hs-type">v2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-180"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-6989586621679492354"><span class="hs-identifier hs-type">k1</span></a><span> </span><a href="#local-6989586621679492356"><span class="hs-identifier hs-type">v1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-6989586621679492355"><span class="hs-identifier hs-type">k2</span></a><span> </span><a href="#local-6989586621679492357"><span class="hs-identifier hs-type">v2</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492350"><span class="hs-identifier hs-type">k1</span></a><span> </span><a href="#local-6989586621679492351"><span class="hs-identifier hs-type">k2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492352"><span class="hs-identifier hs-type">v1</span></a><span> </span><a href="#local-6989586621679492353"><span class="hs-identifier hs-type">v2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-182"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">BigMap</span><span> </span><a href="#local-6989586621679492350"><span class="hs-identifier hs-type">k1</span></a><span> </span><a href="#local-6989586621679492352"><span class="hs-identifier hs-type">v1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">BigMap</span><span> </span><a href="#local-6989586621679492351"><span class="hs-identifier hs-type">k2</span></a><span> </span><a href="#local-6989586621679492353"><span class="hs-identifier hs-type">v2</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Zip.html#ZippedStack"><span class="hs-identifier hs-type">ZippedStack</span></a><span> </span><a href="#local-6989586621679492346"><span class="hs-identifier hs-type">i1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Zip.html#ZippedStack"><span class="hs-identifier hs-type">ZippedStack</span></a><span> </span><a href="#local-6989586621679492347"><span class="hs-identifier hs-type">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Zip.html#ZippedStack"><span class="hs-identifier hs-type">ZippedStack</span></a><span> </span><a href="#local-6989586621679492348"><span class="hs-identifier hs-type">o1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Zip.html#ZippedStack"><span class="hs-identifier hs-type">ZippedStack</span></a><span> </span><a href="#local-6989586621679492349"><span class="hs-identifier hs-type">o2</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-186"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">i1</span></a><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-operator hs-type">:-&gt;</span></a><span> </span><a href="#local-6989586621679492348"><span class="hs-identifier hs-type">o1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">i2</span></a><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-operator hs-type">:-&gt;</span></a><span> </span><a href="#local-6989586621679492349"><span class="hs-identifier hs-type">o2</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492344"><span class="hs-identifier hs-type">a1</span></a><span> </span><a href="#local-6989586621679492345"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-188"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ContractRef</span><span> </span><a href="#local-6989586621679492344"><span class="hs-identifier hs-type">a1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ContractRef</span><span> </span><a href="#local-6989586621679492345"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492338"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492339"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">f</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621679492341"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NamedF</span><span> </span><a href="#local-6989586621679492340"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679492338"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492342"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NamedF</span><span> </span><a href="#local-6989586621679492341"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="#local-6989586621679492339"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679492343"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492334"><span class="hs-identifier hs-type">a1</span></a><span> </span><a href="#local-6989586621679492335"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492336"><span class="hs-identifier hs-type">b1</span></a><span> </span><a href="#local-6989586621679492337"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-193"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492334"><span class="hs-identifier hs-type">a1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492336"><span class="hs-identifier hs-type">b1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492335"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492337"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492328"><span class="hs-identifier hs-type">a1</span></a><span> </span><a href="#local-6989586621679492329"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492330"><span class="hs-identifier hs-type">b1</span></a><span> </span><a href="#local-6989586621679492331"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492332"><span class="hs-identifier hs-type">c1</span></a><span> </span><a href="#local-6989586621679492333"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-195"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492328"><span class="hs-identifier hs-type">a1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492330"><span class="hs-identifier hs-type">b1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492332"><span class="hs-identifier hs-type">c1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492329"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492331"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492333"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492320"><span class="hs-identifier hs-type">a1</span></a><span> </span><a href="#local-6989586621679492321"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492322"><span class="hs-identifier hs-type">b1</span></a><span> </span><a href="#local-6989586621679492323"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492324"><span class="hs-identifier hs-type">c1</span></a><span> </span><a href="#local-6989586621679492325"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492326"><span class="hs-identifier hs-type">d1</span></a><span> </span><a href="#local-6989586621679492327"><span class="hs-identifier hs-type">d2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-197"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492320"><span class="hs-identifier hs-type">a1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492322"><span class="hs-identifier hs-type">b1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492324"><span class="hs-identifier hs-type">c1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492326"><span class="hs-identifier hs-type">d1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492321"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492323"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492325"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492327"><span class="hs-identifier hs-type">d2</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492310"><span class="hs-identifier hs-type">a1</span></a><span> </span><a href="#local-6989586621679492311"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492312"><span class="hs-identifier hs-type">b1</span></a><span> </span><a href="#local-6989586621679492313"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492314"><span class="hs-identifier hs-type">c1</span></a><span> </span><a href="#local-6989586621679492315"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492316"><span class="hs-identifier hs-type">d1</span></a><span> </span><a href="#local-6989586621679492317"><span class="hs-identifier hs-type">d2</span></a><span>
</span><a name="line-199"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492318"><span class="hs-identifier hs-type">e1</span></a><span> </span><a href="#local-6989586621679492319"><span class="hs-identifier hs-type">e2</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-200"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492310"><span class="hs-identifier hs-type">a1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492312"><span class="hs-identifier hs-type">b1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492314"><span class="hs-identifier hs-type">c1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492316"><span class="hs-identifier hs-type">d1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492318"><span class="hs-identifier hs-type">e1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492311"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492313"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492315"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492317"><span class="hs-identifier hs-type">d2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492319"><span class="hs-identifier hs-type">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492298"><span class="hs-identifier hs-type">a1</span></a><span> </span><a href="#local-6989586621679492299"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492300"><span class="hs-identifier hs-type">b1</span></a><span> </span><a href="#local-6989586621679492301"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492302"><span class="hs-identifier hs-type">c1</span></a><span> </span><a href="#local-6989586621679492303"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492304"><span class="hs-identifier hs-type">d1</span></a><span> </span><a href="#local-6989586621679492305"><span class="hs-identifier hs-type">d2</span></a><span>
</span><a name="line-202"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492306"><span class="hs-identifier hs-type">e1</span></a><span> </span><a href="#local-6989586621679492307"><span class="hs-identifier hs-type">e2</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492308"><span class="hs-identifier hs-type">f1</span></a><span> </span><a href="#local-6989586621679492309"><span class="hs-identifier hs-type">f2</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-203"></a><span>         </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492298"><span class="hs-identifier hs-type">a1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492300"><span class="hs-identifier hs-type">b1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492302"><span class="hs-identifier hs-type">c1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492304"><span class="hs-identifier hs-type">d1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492306"><span class="hs-identifier hs-type">e1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492308"><span class="hs-identifier hs-type">f1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679492299"><span class="hs-identifier hs-type">a2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492301"><span class="hs-identifier hs-type">b2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492303"><span class="hs-identifier hs-type">c2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492305"><span class="hs-identifier hs-type">d2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492307"><span class="hs-identifier hs-type">e2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679492309"><span class="hs-identifier hs-type">f2</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-comment">-- | Implementation of 'castDummy' for types composed from smaller types.</span><span>
</span><a name="line-206"></a><span class="hs-comment">-- It helps to ensure that all necessary constraints are requested in instance</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- head.</span><span>
</span><a name="line-208"></a><span class="hs-identifier">castDummyG</span><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span> </span><a href="#local-6989586621679492369"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span> </span><a href="#local-6989586621679492370"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier hs-type">GCanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621679492369"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621679492370"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679492369"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679492370"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-211"></a><a name="castDummyG"><a href="Lorentz.Coercions.html#castDummyG"><span class="hs-identifier">castDummyG</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679492413"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679492414"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679492415"><a href="#local-6989586621679492415"><span class="hs-identifier">_dummy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Dict</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span> </span><a href="#local-6989586621679492413"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span> </span><a href="#local-6989586621679492414"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier hs-type">GCanCastTo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621679492413"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621679492414"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="GCanCastTo"><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier">GCanCastTo</span></a></a><span> </span><a name="local-6989586621679492269"><a href="#local-6989586621679492269"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679492270"><a href="#local-6989586621679492270"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-215"></a><span>  </span><span class="hs-identifier">GCanCastTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.M1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679492271"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.M1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679492272"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier hs-type">GCanCastTo</span></a><span> </span><a href="#local-6989586621679492271"><span class="hs-identifier hs-type">x</span></a><span> </span><a href="#local-6989586621679492272"><span class="hs-identifier hs-type">y</span></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-identifier">GCanCastTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">xl</span><span> </span><span class="hs-operator hs-type">G.:+:</span><span> </span><a href="#local-6989586621679492278"><span class="hs-identifier hs-type">xr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">yl</span><span> </span><span class="hs-operator hs-type">G.:+:</span><span> </span><a href="#local-6989586621679492280"><span class="hs-identifier hs-type">yr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier hs-type">GCanCastTo</span></a><span> </span><a href="#local-6989586621679492277"><span class="hs-identifier hs-type">xl</span></a><span> </span><a href="#local-6989586621679492279"><span class="hs-identifier hs-type">yl</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier hs-type">GCanCastTo</span></a><span> </span><a href="#local-6989586621679492278"><span class="hs-identifier hs-type">xr</span></a><span> </span><a href="#local-6989586621679492280"><span class="hs-identifier hs-type">yr</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-identifier">GCanCastTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">xl</span><span> </span><span class="hs-operator hs-type">G.:*:</span><span> </span><a href="#local-6989586621679492282"><span class="hs-identifier hs-type">xr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">yl</span><span> </span><span class="hs-operator hs-type">G.:*:</span><span> </span><a href="#local-6989586621679492284"><span class="hs-identifier hs-type">yr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier hs-type">GCanCastTo</span></a><span> </span><a href="#local-6989586621679492281"><span class="hs-identifier hs-type">xl</span></a><span> </span><a href="#local-6989586621679492283"><span class="hs-identifier hs-type">yl</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Coercions.html#GCanCastTo"><span class="hs-identifier hs-type">GCanCastTo</span></a><span> </span><a href="#local-6989586621679492282"><span class="hs-identifier hs-type">xr</span></a><span> </span><a href="#local-6989586621679492284"><span class="hs-identifier hs-type">yr</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-identifier">GCanCastTo</span><span> </span><span class="hs-identifier hs-type">G.U1</span><span> </span><span class="hs-identifier hs-type">G.U1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-identifier">GCanCastTo</span><span> </span><span class="hs-identifier hs-type">G.V1</span><span> </span><span class="hs-identifier hs-type">G.V1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>  </span><span class="hs-identifier">GCanCastTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rec0</span><span> </span><a href="#local-6989586621679492285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rec0</span><span> </span><a href="#local-6989586621679492286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span> </span><a href="#local-6989586621679492285"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679492286"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">{- Note about potential use of 'Coercible'.

Alternative to 'CanCastTo' would be using 'Coercible' constraint.

Pros:
* Reflexivity, symmetry and transitivity properties hold automatically.
* Complex structures are handled automatically.

Cons:
* When declaring a datatype type, one should always care to set the corresponding
type role (in most cases it will nominal or representational). Newtypes are
even more difficult to control as they are always coercible if constructor is
in scope.
* Where are some cases where going with 'Coercible' does not work, e.g.
allow @MigrationScriptFrom oldStore@ to @MigrationScript oldStore newStore@.

Despite the mentioned cons, described 'coerce_' may be useful someday.

-}</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- Coercions for some basic types</span><span>
</span><a name="line-244"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">TAddress</span></a><span> </span><a href="#local-6989586621679492297"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">CanCastTo</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-type">Address</span><span>
</span><a name="line-247"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">Address</span></a><span> </span><span class="hs-special">`</span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">CanCastTo</span></a><span class="hs-special">`</span><span> </span><a href="Lorentz.Address.html#TAddress"><span class="hs-identifier hs-type">TAddress</span></a><span> </span><a href="#local-6989586621679492296"><span class="hs-identifier hs-type">p</span></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.Coercions.html#CanCastTo"><span class="hs-identifier hs-type">FutureContract</span></a><span> </span><a href="#local-6989586621679492295"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">CanCastTo</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-type">EpAddress</span><span>
</span><a name="line-250"></a></pre></body></html>